## 웹 통신의 큰 흐름 (by 이찬형)

### 1. 답변

브라우저의 주소창에 www.naver.com을 치게 되면, 먼저 DNS 서버에 입력한 도메인 네임 www.naver.com에 대한 실제 서버 IP 주소를 요청하고 응답을 받게 됩니다. 그 다음 브라우저는 응답받은 서버 IP 주소의 443번 포트(HTTPS 연결)로 TCP 클라이언트로서 TCP 연결을 요청합니다. 서버와의 3 way-handshake 과정을 통해 TCP 연결을 마치고, 브라우저는 TCP 연결을 통해 HTTP 요청 메시지 프로토콜을 준수하여 서버에 요청을 보내게 됩니다. 브라우저 측 호스트 컴퓨터에서는 네트워크 계층을 내려갈 때마다 각 계층의 프로토콜 메시지를 캡슐한 패킷을 라우터로 전송합니다. 패킷을 받은 라우터는 포워딩 테이블과 라우팅 알고리즘에 의해 다음 라우터로 해당 패킷을 전송하는 과정을 반복합니다. 그렇게 네이버 웹 서버 호스트 컴퓨터에 도착한 HTTP 요청 패킷은 네트워크 계층을 올라가면서 역캡슐화를 통해 프로토콜 메시지를 해석합니다. 전송 계층에 도달한 패킷들은 신뢰적인 전송을 보장하는 TCP 프로토콜에 취합된 데이터를 소켓 버퍼에 기록하고 애플리케이션 계층에게 버퍼에 데이터가 있다는 read 이벤트를 발생시킵니다. 웹 서버 어플리케이션에서는 이 이벤트를 감지하여 소켓 버퍼를 읽어 요청 메시지를 파싱 및 확인하고, 요청 메시지에 적힌 요청 내용대로 웹 서버에 있는 리소스를 읽거나 쓰는 동작을 완료합니다. 동작을 완료하면, 동작이 어떻게 처리되었는지에 대한 응답 메시지를 브라우저에게 보내주게 됩니다. 이번에 웹 서버에서는 응답 메시지를 소켓 버퍼에 write하는 이벤트를 통해 반대로 브라우저에게 메시지를 보내는 과정을 거치게 됩니다. 똑같이 라우터를 거쳐 브라우저 호스트 컴퓨터에 도착한 패킷은 소켓 버퍼로부터 read 이벤트를 받게 되고, HTTP 응답 메시지를 완성합니다. 브라우저에서는 응답 메시지를 Contents-Type에 따라 처리합니다. 예를 들어, 응답 데이터가 HTML인 경우 HTML 파서에게 내용을 전달하여 DOM을 만들고, 브라우저에 렌더링하는 과정을 거치게 됩니다.

### 2. 정리

- 추가 질문

  - DNS 조회 알고리즘
  - 3-way handshake
  - 네트워크 각 계층에 대한 자세한 설명
  - 웹 서버 요청 처리 방식(I/O multiplexing)
  - SSL/TLS이 어떻게 적용되는가?

    - SSL/TLS 암호 협상은 TCP 연결이 설정된 후에 진행

      - 암호 협상 : 암호 스위트 선택 => 서로간의 인증 => 세션 키 생성 => 완료 및 보안 통신 시작

    - 애플리케이션 계층의 데이터 => 세션 계층에서 데이터를 암호화 => 전송 계층에서 암호화된 데이터를 페이로드로 TCP 프로토콜 메시지 작성(암호화되지 않음) => 네트워크 계층 프로토콜 메시지 작성(암호화되지 않음) => ...

  - 브라우저 렌더링 과정 : HTML, CSS, JS 파일

### 3. 고쳐야 할 점

- 답변 구조 : DNS => 웹 서버와 TCP 연결 => 요청 메시지 전송 => 네트워크 과정(캡슐화, 포워딩 및 라우팅, 역캡슐화, 소켓 버퍼에 기록) => 메시지 수신(이벤트 감지, 이벤트 처리) => 응답 메시지 전송 => 같은 네트워크 과정 => 브라우저에서는 응답 데이터를 처리

- GPT 피드백

  - 1. 세부 사항에 대한 언급: 주어진 답변은 웹 통신의 큰 흐름을 설명하는데는 탁월하지만, 일부 세부 사항에 대한 언급이 부족합니다. 예를 들어, HTTP 요청과 응답의 구조, TCP의 3-way handshake 과정 등에 대해 좀 더 자세히 설명할 수 있으면 좋을 것입니다.
  - 2. 표현의 간결성: 문장 구조가 조금 복잡하고 길어서 읽기에 어려움이 있을 수 있습니다. 각 단계를 더 간결하게 표현하여 읽기 쉽게 만들 수 있습니다.
  - 3. 플로우의 시각적 표현: 텍스트로 설명하는 것도 좋지만, 흐름을 이해하기 쉽게 시각적으로 표현하는 것이 도움이 될 수 있습니다. 시퀀스 다이어그램이나 간단한 그림을 사용하여 통신 과정을 보다 명확하게 설명할 수 있습니다.
  - 4. 보안 및 보안 계층에 대한 언급: HTTPS 연결의 경우 보안을 강화하기 위해 SSL/TLS 프로토콜이 사용됩니다. 이에 대한 언급이 추가되면 좋을 것입니다.

### 4. keyword

- DNS 조회
- TCP 연결
- HTTP 요청
- 서버 처리
- HTTP 응답
- 데이터 전송
- 응답 처리
